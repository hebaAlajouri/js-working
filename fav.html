<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>المفضلة</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <h2>المفضلة ❤️</h2>
  <div id="favorites-list" class="row"></div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
      const container = document.getElementById("favorites-list");

      if (favorites.length === 0) {
        container.innerHTML = "<p>لا يوجد كتب مفضلة حتى الآن.</p>";
        return;
      }

      // Add saved books to the page
      favorites.forEach((book) => {
        const bookElement = document.createElement("div");
        bookElement.classList.add("col-md-4");
        bookElement.innerHTML = `
          <div class="card">
            <img src="${book.imageUrl}" alt="${book.title}" class="card-img-top">
            <div class="card-body">
              <h5 class="card-title">${book.title}</h5>
              <a href="${book.infoUrl}" class="btn btn-primary">معلومات أكثر</a>
              <button class="love btn btn-danger" data-book-id="${book.id}">
                <i class="fa-solid fa-heart"></i> إزالة من المفضلة
              </button>
            </div>
          </div>
        `;
        container.appendChild(bookElement);
      });

      // Change button appearance for already liked books and set event listeners
      document.querySelectorAll(".love").forEach((button) => {
        button.addEventListener("click", () => removeFavorite(button));
      });
    });

    function removeFavorite(button) {
      let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
      const bookId = button.getAttribute("data-book-id");

      console.log('Removing book with ID:', bookId);

      // Remove from array
      favorites = favorites.filter((book) => book.id !== bookId);

      // Save updated favorites
      localStorage.setItem("favorites", JSON.stringify(favorites));

      // Log the button's closest parent with the .col-md-4 class
      const bookElement = button.closest(".col-md-4");
      console.log('bookElement:', bookElement);

      // Check if the element exists before removing it
      if (bookElement) {
        bookElement.remove();
      } else {
        console.error('Error: Could not find the .col-md-4 element.');
      }
    }
  </script>
</body>
</html>
